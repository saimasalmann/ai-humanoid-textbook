<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 400">
  <title>ROS 2 Node Communication</title>
  <desc>Diagram showing ROS 2 node communication patterns including publisher-subscriber, service, and action patterns</desc>

  <!-- Background -->
  <rect width="100%" height="100%" fill="#f8f9fa"/>

  <!-- Robot Controller Node -->
  <rect x="100" y="100" width="150" height="80" fill="#4285f4" stroke="#1a237e" stroke-width="2" rx="10"/>
  <text x="175" y="135" text-anchor="middle" fill="white" font-family="Arial" font-size="12" font-weight="bold">Robot Controller</text>
  <text x="175" y="155" text-anchor="middle" fill="white" font-family="Arial" font-size="10">Node</text>

  <!-- Navigation Node -->
  <rect x="325" y="50" width="150" height="80" fill="#34a853" stroke="#1b5e20" stroke-width="2" rx="10"/>
  <text x="400" y="85" text-anchor="middle" fill="white" font-family="Arial" font-size="12" font-weight="bold">Navigation Node</text>
  <text x="400" y="105" text-anchor="middle" fill="white" font-family="Arial" font-size="10">Node</text>

  <!-- Perception Node -->
  <rect x="325" y="150" width="150" height="80" fill="#fbbc04" stroke="#f57c00" stroke-width="2" rx="10"/>
  <text x="400" y="185" text-anchor="middle" fill="white" font-family="Arial" font-size="12" font-weight="bold">Perception Node</text>
  <text x="400" y="205" text-anchor="middle" fill="white" font-family="Arial" font-size="10">Node</text>

  <!-- Manipulation Node -->
  <rect x="325" y="250" width="150" height="80" fill="#ea4335" stroke="#b71c1c" stroke-width="2" rx="10"/>
  <text x="400" y="285" text-anchor="middle" fill="white" font-family="Arial" font-size="12" font-weight="bold">Manipulation Node</text>
  <text x="400" y="305" text-anchor="middle" fill="white" font-family="Arial" font-size="10">Node</text>

  <!-- Sensor Node -->
  <rect x="550" y="100" width="150" height="80" fill="#aa00ff" stroke="#4a148c" stroke-width="2" rx="10"/>
  <text x="625" y="135" text-anchor="middle" fill="white" font-family="Arial" font-size="12" font-weight="bold">Sensor Node</text>
  <text x="625" y="155" text-anchor="middle" fill="white" font-family="Arial" font-size="10">Node</text>

  <!-- Publisher-Subscriber Communication -->
  <!-- cmd_vel topic -->
  <path d="M250 130 Q300 130, 325 85" fill="none" stroke="#5f6368" stroke-width="2" stroke-dasharray="5,5">
    <title>cmd_vel topic: Twist messages from controller to navigation</title>
  </path>
  <text x="280" y="110" font-family="Arial" font-size="10" fill="#1a237e">cmd_vel (Twist)</text>

  <!-- sensor_data topic -->
  <path d="M625 130 Q600 130, 475 185" fill="none" stroke="#5f6368" stroke-width="2" stroke-dasharray="5,5">
    <title>sensor_data topic: Sensor messages from sensor to perception</title>
  </path>
  <text x="550" y="160" font-family="Arial" font-size="10" fill="#1a237e">sensor_data (SensorMsg)</text>

  <!-- Service Communication -->
  <!-- get_map service -->
  <path d="M475 75 Q525 75, 625 125" fill="none" stroke="#185abd" stroke-width="2">
    <title>get_map service: Request/Response between navigation and sensor</title>
  </path>
  <text x="550" y="90" font-family="Arial" font-size="10" fill="#185abd">get_map (Service)</text>

  <!-- Action Communication -->
  <!-- navigate_to_pose action -->
  <path d="M250 150 Q300 150, 325 285" fill="none" stroke="#d23f31" stroke-width="3">
    <title>navigate_to_pose action: Goal/Feeback/Result for manipulation</title>
  </path>
  <text x="280" y="220" font-family="Arial" font-size="10" fill="#d23f31">navigate_to_pose (Action)</text>

  <!-- Arrowheads for different communication types -->
  <defs>
    <marker id="pubsub-arrow" markerWidth="10" markerHeight="7"
      refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#5f6368"/>
    </marker>
    <marker id="service-arrow" markerWidth="10" markerHeight="7"
      refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#185abd"/>
    </marker>
    <marker id="action-arrow" markerWidth="10" markerHeight="7"
      refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#d23f31"/>
    </marker>
  </defs>

  <!-- Add arrowheads to paths -->
  <path d="M250 130 L325 85" fill="none" stroke="transparent" stroke-width="2" marker-end="url(#pubsub-arrow)" pointer-events="none"/>
  <path d="M625 130 L475 185" fill="none" stroke="transparent" stroke-width="2" marker-end="url(#pubsub-arrow)" pointer-events="none"/>
  <path d="M475 75 L625 125" fill="none" stroke="transparent" stroke-width="2" marker-end="url(#service-arrow)" pointer-events="none"/>
  <path d="M250 150 L325 285" fill="none" stroke="transparent" stroke-width="2" marker-end="url(#action-arrow)" pointer-events="none"/>

  <!-- Communication Legend -->
  <rect x="50" y="320" width="250" height="70" fill="none" stroke="#cccccc" stroke-width="1"/>
  <text x="60" y="340" font-family="Arial" font-size="12" font-weight="bold">ROS 2 Communication Patterns</text>
  <text x="60" y="355" font-family="Arial" font-size="10" fill="#5f6368">● Publisher-Subscriber: Topic-based (solid/dashed line)</text>
  <text x="60" y="370" font-family="Arial" font-size="10" fill="#185abd">● Service: Request-Response (solid line)</text>
  <text x="60" y="385" font-family="Arial" font-size="10" fill="#d23f31">● Action: Goal-Feedback-Result (thick line)</text>

  <!-- Network Infrastructure -->
  <ellipse cx="400" cy="350" rx="100" ry="20" fill="none" stroke="#9e9e9e" stroke-width="2" stroke-dasharray="5,5"/>
  <text x="400" y="355" text-anchor="middle" fill="#616161" font-family="Arial" font-size="10">DDS/RMW Layer (Fast DDS, Cyclone)</text>

  <!-- Title -->
  <text x="400" y="30" text-anchor="middle" fill="#202124" font-family="Arial" font-size="16" font-weight="bold">ROS 2 Node Communication Architecture</text>
  <text x="400" y="45" text-anchor="middle" fill="#5f6368" font-family="Arial" font-size="12">Decentralized communication using Data Distribution Service (DDS)</text>
</svg>